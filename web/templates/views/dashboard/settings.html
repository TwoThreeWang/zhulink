{{ template "base.html" . }}

{{ define "content" }}
<!-- Dashboard è®¾ç½®é¡µ - ç´§å‡‘ã€å»æ¡†åŒ–è®¾è®¡ -->

<div class="max-w-5xl mx-auto py-8">
    <div class="flex flex-col md:flex-row gap-8 md:gap-12">
        <!-- ä¾§è¾¹æ  -->
        <aside class="md:w-48 flex-shrink-0">
            {{ template "dashboard_sidebar.html" dict "Active" "settings" "UnreadCount" .UnreadCount "CurrentUser"
            .CurrentUser }}
        </aside>

        <!-- ä¸»å†…å®¹åŒº -->
        <main class="flex-grow min-w-0">
            <h1 class="text-xl font-bold text-ink mb-6 pl-1">è´¦æˆ·è®¾ç½®</h1>

            {{ if .Error }}
            <div class="mb-6 p-3 bg-red-50 border border-red-100 rounded text-red-700 text-sm flex items-center gap-2">
                <i data-lucide="alert-circle" class="w-4 h-4"></i>
                {{ .Error }}
            </div>
            {{ end }}

            <form method="POST" action="/dashboard/settings" class="space-y-8 max-w-2xl">
                <!-- åŸºæœ¬ä¿¡æ¯ -->
                <section>
                    <h2
                        class="text-xs text-stone-400 uppercase tracking-widest font-sans mb-4 border-b border-stone-100 pb-2">
                        åŸºæœ¬ä¿¡æ¯</h2>

                    <!-- ç”¨æˆ·å -->
                    <div class="mb-4 group">
                        <label for="username" class="block text-sm font-medium text-ink mb-1.5">ç”¨æˆ·å</label>
                        <input type="text" name="username" id="username" value="{{ .User.Username }}"
                            class="w-full px-3 py-2 border border-stone-200 rounded focus:outline-none focus:ring-1 focus:ring-moss focus:border-moss bg-white text-sm transition-colors group-hover:border-stone-300">
                        <p class="mt-1 text-xs text-stone-400">åœ¨ç¤¾åŒºä¸­æ˜¾ç¤ºçš„åç§°</p>
                    </div>

                    <!-- é‚®ç®± -->
                    <div class="mb-4 group">
                        <label for="email" class="block text-sm font-medium text-ink mb-1.5">é‚®ç®±</label>
                        <input type="email" name="email" id="email" value="{{ .User.Email }}"
                            class="w-full px-3 py-2 border border-stone-200 rounded focus:outline-none focus:ring-1 focus:ring-moss focus:border-moss bg-white text-sm transition-colors group-hover:border-stone-300">
                        <p class="mt-1 text-xs text-stone-400">ç”¨äºç™»å½•å’Œæ¥æ”¶é€šçŸ¥</p>
                    </div>

                    <!-- ä¸ªäººç®€ä»‹ -->
                    <div class="group">
                        <label for="bio" class="block text-sm font-medium text-ink mb-1.5">ä¸ªäººç®€ä»‹</label>
                        <textarea name="bio" id="bio" rows="3" maxlength="200"
                            class="w-full px-3 py-2 border border-stone-200 rounded focus:outline-none focus:ring-1 focus:ring-moss focus:border-moss bg-white resize-none text-sm transition-colors group-hover:border-stone-300">{{ .User.Bio }}</textarea>
                        <p class="mt-1 text-xs text-stone-400">ä¸€å¥è¯ä»‹ç»è‡ªå·±ï¼ˆæœ€å¤š200å­—ï¼‰</p>
                    </div>
                </section>

                <!-- å¤´åƒé€‰æ‹© -->
                <section>
                    <h2
                        class="text-xs text-stone-400 uppercase tracking-widest font-sans mb-4 border-b border-stone-100 pb-2">
                        å¤´åƒè®¾ç½®</h2>

                    <div class="flex items-center gap-4 mb-5">
                        <div class="text-4xl ring-4 ring-white shadow-md rounded-full w-14 h-14 flex items-center justify-center bg-white select-none"
                            id="current-avatar">
                            {{ .User.Avatar }}
                        </div>
                        <div>
                            <p class="text-xs text-stone-400">ç‚¹å‡»ä¸‹æ–¹ Emoji æˆ–è¾“å…¥è‡ªå®šä¹‰å¤´åƒ</p>
                        </div>
                    </div>

                    <input type="hidden" name="avatar" id="avatar-input" value="{{ .User.Avatar }}">

                    <!-- å¸¸ç”¨ emoji -->
                    <div class="mb-4">
                        <div class="grid grid-cols-8 sm:grid-cols-10 gap-1">
                            {{ range .CommonEmojis }}
                            <button type="button" onclick="selectEmoji('{{ . }}')"
                                class="text-xl p-1.5 hover:bg-moss/10 rounded transition-colors border border-transparent hover:border-moss/20">
                                {{ . }}
                            </button>
                            {{ end }}
                        </div>
                    </div>

                    <!-- è‡ªå®šä¹‰ emoji è¾“å…¥ -->
                    <div>
                        <div class="flex gap-2 max-w-xs">
                            <input type="text" id="custom-emoji" placeholder="è¾“å…¥ Emoji"
                                class="flex-grow px-3 py-2 border border-stone-200 rounded focus:outline-none focus:ring-1 focus:ring-moss focus:border-moss bg-white text-sm">
                            <button type="button" onclick="selectCustomEmoji()"
                                class="px-4 py-2 bg-moss text-white rounded hover:bg-moss/90 transition-colors text-sm font-medium">
                                åº”ç”¨
                            </button>
                        </div>
                    </div>
                </section>

                <!-- ä¿®æ”¹å¯†ç  -->
                <section>
                    <h2
                        class="text-xs text-stone-400 uppercase tracking-widest font-sans mb-4 border-b border-stone-100 pb-2">
                        å®‰å…¨è®¾ç½®</h2>

                    <div class="mb-4 group">
                        <label for="old_password" class="block text-sm font-medium text-ink mb-1.5">åŸå¯†ç </label>
                        <input type="password" name="old_password" id="old_password"
                            class="w-full px-3 py-2 border border-stone-200 rounded focus:outline-none focus:ring-1 focus:ring-moss focus:border-moss bg-white text-sm transition-colors group-hover:border-stone-300">
                        {{ if .User.GoogleID }}
                        <p class="mt-1 text-xs text-stone-400">ğŸ’¡ é€šè¿‡ Google ç™»å½•æ³¨å†Œçš„ç”¨æˆ·,ä¿®æ”¹å¯†ç æ—¶åŸå¯†ç å¯ä»¥ç•™ç©º</p>
                        {{ end }}
                    </div>

                    <div class="group">
                        <label for="new_password" class="block text-sm font-medium text-ink mb-1.5">æ–°å¯†ç </label>
                        <input type="password" name="new_password" id="new_password"
                            class="w-full px-3 py-2 border border-stone-200 rounded focus:outline-none focus:ring-1 focus:ring-moss focus:border-moss bg-white text-sm transition-colors group-hover:border-stone-300">
                        <p class="mt-1 text-xs text-stone-400">ä¸ä¿®æ”¹è¯·ç•™ç©º,è‡³å°‘6ä½å­—ç¬¦</p>
                    </div>

                    <!-- Google è´¦å·ç»‘å®š -->
                    <div class="mt-6 pt-6 border-t border-stone-100">
                        <h3 class="text-sm font-medium text-ink mb-3">Google è´¦å·</h3>
                        {{ if .User.GoogleID }}
                        <!-- å·²ç»‘å®šçŠ¶æ€ -->
                        <div class="flex items-center justify-between p-3 bg-stone-50 rounded">
                            <div class="flex items-center gap-3">
                                <svg width="20" height="20" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg">
                                    <g fill="none" fill-rule="evenodd">
                                        <path
                                            d="M17.64 9.205c0-.639-.057-1.252-.164-1.841H9v3.481h4.844a4.14 4.14 0 0 1-1.796 2.716v2.259h2.908c1.702-1.567 2.684-3.875 2.684-6.615z"
                                            fill="#4285F4" />
                                        <path
                                            d="M9 18c2.43 0 4.467-.806 5.956-2.18l-2.908-2.259c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332A8.997 8.997 0 0 0 9 18z"
                                            fill="#34A853" />
                                        <path
                                            d="M3.964 10.71A5.41 5.41 0 0 1 3.682 9c0-.593.102-1.17.282-1.71V4.958H.957A8.996 8.996 0 0 0 0 9c0 1.452.348 2.827.957 4.042l3.007-2.332z"
                                            fill="#FBBC05" />
                                        <path
                                            d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0A8.997 8.997 0 0 0 .957 4.958L3.964 7.29C4.672 5.163 6.656 3.58 9 3.58z"
                                            fill="#EA4335" />
                                    </g>
                                </svg>
                                <div>
                                    <p class="text-sm text-ink">{{ .User.GoogleEmail }}</p>
                                    <p class="text-xs text-stone-400">å·²ç»‘å®š</p>
                                </div>
                            </div>
                            <form action="/dashboard/settings/unbind-google" method="POST" style="display: inline;">
                                <button type="submit" onclick="return confirm('ç¡®å®šè¦è§£é™¤ Google è´¦å·ç»‘å®šå—?')"
                                    class="text-xs text-red-500 hover:text-red-700 font-medium transition-colors">
                                    è§£é™¤ç»‘å®š
                                </button>
                            </form>
                        </div>
                        {{ else }}
                        <!-- æœªç»‘å®šçŠ¶æ€ -->
                        <a href="/dashboard/settings/bind-google"
                            class="flex items-center justify-center gap-3 border border-stone-300 p-3 rounded hover:bg-stone-50 transition-colors">
                            <svg width="18" height="18" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg">
                                <g fill="none" fill-rule="evenodd">
                                    <path
                                        d="M17.64 9.205c0-.639-.057-1.252-.164-1.841H9v3.481h4.844a4.14 4.14 0 0 1-1.796 2.716v2.259h2.908c1.702-1.567 2.684-3.875 2.684-6.615z"
                                        fill="#4285F4" />
                                    <path
                                        d="M9 18c2.43 0 4.467-.806 5.956-2.18l-2.908-2.259c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332A8.997 8.997 0 0 0 9 18z"
                                        fill="#34A853" />
                                    <path
                                        d="M3.964 10.71A5.41 5.41 0 0 1 3.682 9c0-.593.102-1.17.282-1.71V4.958H.957A8.996 8.996 0 0 0 0 9c0 1.452.348 2.827.957 4.042l3.007-2.332z"
                                        fill="#FBBC05" />
                                    <path
                                        d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0A8.997 8.997 0 0 0 .957 4.958L3.964 7.29C4.672 5.163 6.656 3.58 9 3.58z"
                                        fill="#EA4335" />
                                </g>
                            </svg>
                            <span class="text-sm font-medium text-ink">ç»‘å®š Google è´¦å·</span>
                        </a>
                        <p class="mt-2 text-xs text-stone-400">ç»‘å®šåå¯ä½¿ç”¨ Google è´¦å·å¿«é€Ÿç™»å½•</p>
                        {{ end }}
                    </div>
                </section>

                <!-- æäº¤æŒ‰é’® -->
                <div class="flex items-center justify-between pt-6 mt-8 border-t border-stone-100">
                    <a href="/logout"
                        class="text-xs text-red-500 hover:text-red-700 font-medium transition-colors">é€€å‡ºç™»å½•</a>
                    <button type="submit"
                        class="px-6 py-2 bg-moss text-white rounded hover:bg-moss/90 transition-colors text-sm font-bold shadow-sm hover:shadow">
                        ä¿å­˜æ›´æ”¹
                    </button>
                </div>
            </form>
        </main>
    </div>
</div>

<script>
    function selectEmoji(emoji) {
        document.getElementById('current-avatar').textContent = emoji;
        document.getElementById('avatar-input').value = emoji;
    }

    function selectCustomEmoji() {
        const customEmoji = document.getElementById('custom-emoji').value.trim();
        if (customEmoji) {
            document.getElementById('current-avatar').textContent = customEmoji;
            document.getElementById('avatar-input').value = customEmoji;
            document.getElementById('custom-emoji').value = '';
        }
    }
</script>

{{ end }}