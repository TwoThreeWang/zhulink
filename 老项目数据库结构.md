数据库结构文档
本文档整理了 go_simple_forum 项目中的所有数据表结构,用于数据迁移规划。

1. 用户表 (tb_user)
表说明: 存储用户基本信息和统计数据

字段列表
ID - uint (主键,自增)

GORM 默认字段,用户唯一标识
CreatedAt - time.Time

GORM 默认字段,创建时间
UpdatedAt - time.Time

GORM 默认字段,更新时间
DeletedAt - gorm.DeletedAt (索引)

GORM 默认字段,软删除时间
Username - varchar(30) (唯一)

用户名,必须唯一
Password - varchar(100)

加密后的密码
Role - varchar(20)

用户角色 (如: admin, user 等)
Email - varchar(100)

用户邮箱
Bio - varchar(100)

用户个人简介
CommentCount - int

评论数量统计
PostCount - int

发帖数量统计
Status - varchar(20)

用户状态 (如: active, banned, muted 等)
Avatar - varchar(500)

头像URL
Points - int (默认: 0)

用户积分 (竹笋)
PunchAt - timestamptz(6)

最后打卡时间
GoogleId - varchar(100)

Google 账号绑定 ID
关联关系
一对多: Posts (通过 UserID 外键)
一对多: Comments (通过 UserID 外键)
多对多: UpVotedPosts (通过 tb_vote 中间表)
多对多: UpVotedComments (通过 tb_vote 中间表)
2. 文章表 (tb_post)
表说明: 存储论坛文章/帖子信息

字段列表
ID - uint (主键,自增)

文章唯一标识
CreatedAt - time.Time

创建时间
UpdatedAt - time.Time

更新时间
DeletedAt - gorm.DeletedAt (索引)

软删除时间
Title - varchar(100)

文章标题
Link - varchar(1024)

外部链接 (如果是链接类型文章)
Status - varchar(20)

文章状态 (如: published, draft, deleted 等)
Content - text

文章内容 (Markdown 格式)
UnEscapeContent - template.HTML (不存储)

渲染后的 HTML 内容,仅用于模板显示
UpVote - int

点赞数
CollectVote - int

收藏数
Type - varchar(20)

文章类型 (如: article, link 等)
UserID - uint (外键)

作者用户 ID
Remark - varchar(256)

备注信息
Domain - varchar(256)

链接域名 (从 Link 提取)
Pid - varchar(20) (唯一)

文章公开 ID (用于 URL)
CommentCount - int

评论数量统计
Point - decimal(20,10)

文章热度分数
UpVoted - int (不存储)

当前用户是否点赞,仅用于查询
CollectVoted - int (不存储)

当前用户是否收藏,仅用于查询
Top - int (默认: 0)

置顶标记 (0: 不置顶, 1: 置顶)
ClickVote - int (默认: 0)

点击数
关联关系
多对一:
User
 (通过 UserID 外键)
一对多: Comments (通过 PostID 外键)
多对多: Tags (通过 tb_post_tag 中间表)
3. 评论表 (tb_comment)
表说明: 存储文章评论信息,支持嵌套回复

字段列表
ID - uint (主键,自增)

评论唯一标识
CreatedAt - time.Time

创建时间
UpdatedAt - time.Time

更新时间
DeletedAt - gorm.DeletedAt (索引)

软删除时间
UserID - uint (外键)

评论者用户 ID
Content - varchar

评论内容
CID - varchar(20)

评论公开 ID (用于锚点定位)
PostID - uint (外键)

所属文章 ID
ParentCommentID - uint (外键,可空)

父评论 ID (用于嵌套回复)
UpVote - int

点赞数
DownVote - int

踩数
UpVoted - int (不存储)

当前用户是否点赞,仅用于查询
关联关系
多对一:
User
 (通过 UserID 外键)
多对一:
Post
 (通过 PostID 外键)
多对一: ParentComment (通过 ParentCommentID 外键,自关联)
一对多: Comments (子评论,通过 ParentCommentID 外键)
4. 标签/节点表 (tb_tag)
表说明: 存储论坛节点/标签信息,支持层级结构

字段列表
ID - uint (主键,自增)

标签唯一标识
CreatedAt - time.Time

创建时间
UpdatedAt - time.Time

更新时间
DeletedAt - gorm.DeletedAt (索引)

软删除时间
Name - varchar(50) (唯一)

标签名称
Desc - varchar(128)

标签描述
ParentID - uint (外键,可空)

父标签 ID (用于层级分类)
CssClass - varchar(120)

自定义 CSS 类名
ShowInHot - varchar(5)

是否在热门页显示 (yes/no)
ShowInAll - varchar(5)

是否在全部页显示 (yes/no)
OpenShow - int8(5)

是否公开显示
关联关系
多对一: Parent (通过 ParentID 外键,自关联)
一对多: Children (子标签,通过 ParentID 外键)
多对多: Posts (通过 tb_post_tag 中间表)
5. 消息/通知表 (tb_message)
表说明: 存储用户之间的消息和系统通知

字段列表
ID - uint (主键,自增)

消息唯一标识
CreatedAt - time.Time

创建时间
UpdatedAt - time.Time

更新时间
DeletedAt - gorm.DeletedAt (索引)

软删除时间
Content - varchar

消息内容 (支持 HTML)
Read - varchar(1)

是否已读 (Y/N)
FromUserID - uint (外键)

发送者用户 ID (系统消息为 999999999)
ToUserID - uint (外键)

接收者用户 ID
关联关系
多对一: FromUser (通过 FromUserID 外键)
多对一: ToUser (通过 ToUserID 外键)
6. 投票表 (tb_vote)
表说明: 存储用户对文章和评论的投票记录 (点赞/踩/收藏)

字段列表
ID - uint (主键,自增)

投票记录唯一标识
CreatedAt - time.Time

创建时间
UpdatedAt - time.Time

更新时间
DeletedAt - gorm.DeletedAt (索引)

软删除时间
UserID - uint (外键)

投票用户 ID (字段名: tb_user_id)
TargetID - uint

目标 ID (文章 ID 或评论 ID)
Action - varchar(20)

投票动作 (如: upvote, downvote, collect)
Type - varchar(20)

目标类型 (如: post, comment)
说明
此表作为多对多关系的中间表,同时记录投票类型和动作